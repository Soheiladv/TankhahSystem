{% extends 'base.html' %}
{% block content %}
<div class="container">
    <h2>{{ title }}</h2>
    {% if page_obj %}
        <div class="list-group">
            {% for notification in page_obj %}
                <div class="list-group-item list-group-item-warning">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">{{ notification.verb }} ({{ notification.get_entity_type_display }})</h5>
                        <small>{{ notification.timestamp|date:"Y/m/d H:i" }}</small>
                    </div>
                    <p class="mb-1">{{ notification.description }}</p>
                    <small>توسط: {{ notification.actor.username|default:"ناشناس" }}</small>
                    {% if notification.target %}
                        <small>هدف: {{ notification.target }}</small>
                    {% endif %}
                    <small>اولویت: {{ notification.get_priority_display }}</small>
                    <button class="btn btn-sm btn-danger delete-notification" data-id="{{ notification.id }}">حذف</button>
                </div>
            {% endfor %}
        </div>
        <!-- صفحه‌بندی -->
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">قبلی</a></li>
                {% endif %}
                {% for num in page_obj.paginator.page_range %}
                    <li class="page-item {% if page_obj.number == num %}active{% endif %}"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                {% endfor %}
                {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">بعدی</a></li>
                {% endif %}
            </ul>
        </nav>
    {% else %}
        <p>هیچ اعلان خوانده‌نشده‌ای وجود ندارد.</p>
    {% endif %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.delete-notification').forEach(button => {
        button.addEventListener('click', function() {
            const notificationId = this.getAttribute('data-id');
            fetch(`/notifications/delete/${notificationId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    this.closest('.list-group-item').remove();
                } else {
                    alert(data.message);
                }
            });
        });
    });
});
</script>
{% endblock %}
{#{% extends "base.html" %}#}
{#{% load i18n jformat %}#}
{##}
{#{% block title %}{{ title }}{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mt-5">#}
{#    <h2 class="mb-4">{{ title }}</h2>#}
{##}
{#    <!-- لیست اعلان‌های خوانده‌نشده -->#}
{#    <div class="card">#}
{#        <div class="card-body">#}
{#            {% if page_obj %}#}
{#                {% for notification in page_obj %}#}
{#                    <div class="alert alert-info alert-dismissible fade show d-flex justify-content-between align-items-center" role="alert">#}
{#                        <div>#}
{#                            <div class="d-flex align-items-center">#}
{#                                <i class="fas fa-bell me-2 text-primary"></i>#}
{#                                <div>#}
{#                                    <p class="mb-0">#}
{#                                        {{ notification.actor.username }} {{ notification.verb }}#}
{#                                        {% if notification.target %}#}
{#                                            ({{ notification.target }})#}
{#                                        {% endif %}#}
{#                                    </p>#}
{#                                    {% if notification.description %}#}
{#                                        <small class="text-muted">{{ notification.description }}</small><br>#}
{#                                    {% endif %}#}
{#                                    <small class="text-muted">{{ notification.timestamp|jformat:"%Y/%m/%d %H:%i" }}</small>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div>#}
{#                            <a href="{% url 'notifications:mark_as_read' notification.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-primary me-2">{% trans "خواندن" %}</a>#}
{#                            <button class="btn btn-sm btn-outline-danger delete-notification" data-id="{{ notification.id }}">{% trans "حذف" %}</button>#}
{#                        </div>#}
{#                    </div>#}
{#                {% endfor %}#}
{#                <!-- صفحه‌بندی -->#}
{#                <nav aria-label="Page navigation">#}
{#                    <ul class="pagination">#}
{#                        {% if page_obj.has_previous %}#}
{#                            <li class="page-item">#}
{#                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">{% trans "قبلی" %}</a>#}
{#                            </li>#}
{#                        {% endif %}#}
{#                        {% for num in page_obj.paginator.page_range %}#}
{#                            <li class="page-item {% if page_obj.number == num %}active{% endif %}">#}
{#                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>#}
{#                            </li>#}
{#                        {% endfor %}#}
{#                        {% if page_obj.has_next %}#}
{#                            <li class="page-item">#}
{#                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">{% trans "بعدی" %}</a>#}
{#                            </li>#}
{#                        {% endif %}#}
{#                    </ul>#}
{#                </nav>#}
{#            {% else %}#}
{#                <div class="alert alert-info">{% trans "اعلان خوانده‌نشده‌ای وجود ندارد" %}</div>#}
{#            {% endif %}#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- لینک بازگشت به صندوق ورودی -->#}
{#    <a href="{% url 'notifications:inbox' %}" class="btn btn-secondary mt-3">{% trans "بازگشت به صندوق ورودی" %}</a>#}
{#</div>#}
{##}
{#<script>#}
{#$(document).ready(function () {#}
{#    $('.delete-notification').on('click', function () {#}
{#        const notificationId = $(this).data('id');#}
{#        const listItem = $(this).closest('.alert');#}
{#        $.ajax({#}
{#            url: "{% url 'notifications:delete_notification' 0 %}".replace('0', notificationId),#}
{#            type: "POST",#}
{#            data: {#}
{#                'csrfmiddlewaretoken': '{{ csrf_token }}'#}
{#            },#}
{#            success: function (response) {#}
{#                if (response.status === 'success') {#}
{#                    listItem.remove();#}
{#                }#}
{#            },#}
{#            error: function (xhr) {#}
{#                console.error("Error deleting notification:", xhr.responseJSON.message);#}
{#            }#}
{#        });#}
{#    });#}
{#});#}
{#</script>#}
{#{% endblock %}#}
{% load i18n jformat humanize rcms_custom_filters %}

{% if approval_logs %}
    <ul class="list-group list-group-flush">
        {% for log in approval_logs %}
            <li class="list-group-item px-0 py-3">
                <div class="d-flex w-100">
                    <div>
                        <i class="fas fa-history text-muted me-3 fs-4"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between">
                            <h6 class="mb-1 fw-bold">
                                {{ log.action.name }}
                                <span class="fw-normal text-muted">{% trans "توسط" %}</span>
                                {{ log.user.get_full_name|default:log.user.username }}
                                <span class="fw-normal text-muted">({{ log.post.name|default:'پست نامشخص' }})</span>
                            </h6>
                            <small class="text-muted">{{ log.timestamp|jformat:"%Y/%m/%d - %H:%M"|to_persian_number }}</small>
                        </div>
                        <p class="mb-1 small">
                            {% blocktrans with from_status=log.from_status.name to_status=log.to_status.name %}
                            تغییر وضعیت از <strong class="text-secondary">{{ from_status }}</strong> به <strong class="text-success">{{ to_status }}</strong>
                            {% endblocktrans %}
                        </p>
                        {% if log.comment %}
                            <p class="mb-0 mt-2 p-2 bg-light border rounded small fst-italic">
                                <i class="fas fa-comment-dots me-1"></i> {{ log.comment|linebreaksbr }}
                            </p>
                        {% endif %}
                    </div>
                </div>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <div class="alert alert-secondary text-center">
        <i class="fas fa-info-circle me-2"></i>
        {% trans "هیچ تاریخچه‌ای برای این فاکتور ثبت نشده است." %}
    </div>
{% endif %}



<table class="table table-striped">
    <thead>
        <tr>
            <th>{% trans "تاریخ" %}</th>
            <th>{% trans "کاربر" %}</th>
            <th>{% trans "پست" %}</th>
            <th>{% trans "اقدام" %}</th>
            <th>{% trans "وضعیت قبلی" %}</th>
            <th>{% trans "وضعیت جدید" %}</th>
            <th>{% trans "توضیحات" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for log in approval_logs %}
        <tr>
            <td>{{ log.timestamp|jformat:"%Y/%m/%d %H:%M"|to_persian_number }}</td>
            <td>{{ log.user.get_full_name|default:log.user.username }}</td>
            <td>{{ log.post.title }}</td>
            <td>{{ log.action.name }}</td>
            <td>{{ log.from_status.name }}</td>
            <td>{{ log.to_status.name}}</td>
            <td>{{ log.comment|linebreaksbr }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="7" class="text-center">{% trans "هیچ اقدامی ثبت نشده است." %}</td></tr>
        {% endfor %}
    </tbody>
</table>

{% if next_steps_with_posts %}
<div class="mt-3 alert alert-info">
    <strong>{% trans "کاربران مرحله بعد:" %}</strong>
    <ul>
        {% for step in next_steps_with_posts %}
            <li>
                {{ step.action.name }} → وضعیت "{{ step.to_status.name }}"
                <ul>
                    {% for post in step.posts %}
                        <li>{{ post.name }}</li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

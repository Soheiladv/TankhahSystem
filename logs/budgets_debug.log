[2025-07-27 09:52:03] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-07-27 10:06:49] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-07-27 10:06:49] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001AB4943EE40>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001AB4924BB60>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-07-27 10:06:51] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-07-27 10:06:51] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001AB4941C550>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001AB4924B620>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('24000000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': 'شش ماهه ابتدای سال 1404', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-07-27 10:43:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:375] get_context_data - BudgetAllocationDetailView context: {'object': <BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, 'budget_allocation': <BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationDetailView object at 0x0000025CA273DD30>, 'budget_details': {'total_budget': Decimal('0'), 'total_allocated': Decimal('0'), 'remaining_budget': Decimal('0'), 'project_count': 0, 'allocation_count': 0, 'last_update': None, 'status_message': 'نامشخص'}}
[2025-07-27 10:43:30] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:375] get_context_data - BudgetAllocationDetailView context: {'object': <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>, 'budget_allocation': <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationDetailView object at 0x0000025CA2470410>, 'budget_details': {'total_budget': Decimal('0'), 'total_allocated': Decimal('0'), 'remaining_budget': Decimal('0'), 'project_count': 0, 'allocation_count': 0, 'last_update': None, 'status_message': 'نامشخص'}}
[2025-07-29 15:14:38] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-07-29 15:14:38] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A33E3E00>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001E6A33E38C0>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('24000000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-07-29 15:16:15] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-07-29 15:16:15] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A3479310>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001E6A33E3E00>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 22
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/07
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 22
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=80000000000, remaining=56000000000.00
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-07-29 15:17:46] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-07-29 15:17:46] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A38BED70>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001E6A395E210>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-07-29 15:17:49] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-07-29 15:17:49] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A38BEFD0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001E6A3479810>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('24000000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': 'شش ماهه ابتدای سال 1404', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-07-29 15:21:22] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-29 15:21:22] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-29 15:21:22] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-31 08:20:47] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-31 08:20:47] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=100, type=CONSUMPTION, allocation ID=76
[2025-07-31 08:20:47] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=100, type=CONSUMPTION, allocation ID=76
[2025-07-31 08:20:47] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-07-31 08:20:47] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040509-HSarein-0001-1753937447 created. Invalidating cache for allocation 76
[2025-07-31 08:20:47] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-31 08:20:47] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-07-31 08:20:47] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_22_all_no_filters', 'project_remaining_budget_8', 'free_budget_76', 'budget_transfers_22_no_filters'}
[2025-07-31 08:20:47] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 76
[2025-07-31 08:20:47] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-07-31 08:20:47] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-03 09:25:10] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=100000, type=CONSUMPTION, allocation ID=76
[2025-08-03 09:25:10] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=100000, type=CONSUMPTION, allocation ID=76
[2025-08-03 09:25:10] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-03 09:25:10] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040512-HSarein-0001-1754200510 created. Invalidating cache for allocation 76
[2025-08-03 09:25:11] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-03 09:25:11] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-03 09:25:11] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'budget_transfers_22_no_filters', 'free_budget_76', 'project_remaining_budget_8', 'returned_budgets_22_all_no_filters'}
[2025-08-03 09:25:11] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 77
[2025-08-03 09:25:11] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-08-03 09:25:11] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-03 15:28:00] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=500, type=CONSUMPTION, allocation ID=76
[2025-08-03 15:28:00] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=500, type=CONSUMPTION, allocation ID=76
[2025-08-03 15:28:00] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-03 15:28:00] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040512-HSarein-0002-1754222280 created. Invalidating cache for allocation 76
[2025-08-03 15:28:00] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-03 15:28:00] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-03 15:28:00] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_22_all_no_filters', 'budget_transfers_22_no_filters', 'free_budget_76', 'project_remaining_budget_8'}
[2025-08-03 15:28:00] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 78
[2025-08-03 15:28:00] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-08-03 15:28:00] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')

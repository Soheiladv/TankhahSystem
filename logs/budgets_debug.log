[2025-07-27 09:52:03] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-07-27 10:06:49] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-07-27 10:06:49] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001AB4943EE40>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001AB4924BB60>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-07-27 10:06:51] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-07-27 10:06:51] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001AB4941C550>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001AB4924B620>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('24000000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': 'شش ماهه ابتدای سال 1404', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-07-27 10:43:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:375] get_context_data - BudgetAllocationDetailView context: {'object': <BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, 'budget_allocation': <BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationDetailView object at 0x0000025CA273DD30>, 'budget_details': {'total_budget': Decimal('0'), 'total_allocated': Decimal('0'), 'remaining_budget': Decimal('0'), 'project_count': 0, 'allocation_count': 0, 'last_update': None, 'status_message': 'نامشخص'}}
[2025-07-27 10:43:30] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:375] get_context_data - BudgetAllocationDetailView context: {'object': <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>, 'budget_allocation': <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationDetailView object at 0x0000025CA2470410>, 'budget_details': {'total_budget': Decimal('0'), 'total_allocated': Decimal('0'), 'remaining_budget': Decimal('0'), 'project_count': 0, 'allocation_count': 0, 'last_update': None, 'status_message': 'نامشخص'}}
[2025-07-29 15:14:38] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-07-29 15:14:38] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A33E3E00>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001E6A33E38C0>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('24000000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-07-29 15:16:15] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-07-29 15:16:15] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A3479310>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001E6A33E3E00>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 22
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/07
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 22
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-07-29 15:16:26] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=80000000000, remaining=56000000000.00
[2025-07-29 15:16:26] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-07-29 15:17:46] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-07-29 15:17:46] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A38BED70>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001E6A395E210>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-07-29 15:17:49] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-07-29 15:17:49] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001E6A38BEFD0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - پژوهش - 1404/04/31 - 16,000,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - بازسازی مراکز - 1404/04/30 - 8,000,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001E6A3479810>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('24000000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': 'شش ماهه ابتدای سال 1404', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-07-29 15:21:22] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-29 15:21:22] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-29 15:21:22] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-31 08:20:47] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-31 08:20:47] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=100, type=CONSUMPTION, allocation ID=76
[2025-07-31 08:20:47] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=100, type=CONSUMPTION, allocation ID=76
[2025-07-31 08:20:47] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-07-31 08:20:47] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040509-HSarein-0001-1753937447 created. Invalidating cache for allocation 76
[2025-07-31 08:20:47] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-07-31 08:20:47] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-07-31 08:20:47] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_22_all_no_filters', 'project_remaining_budget_8', 'free_budget_76', 'budget_transfers_22_no_filters'}
[2025-07-31 08:20:47] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 76
[2025-07-31 08:20:47] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-07-31 08:20:47] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-03 09:25:10] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=100000, type=CONSUMPTION, allocation ID=76
[2025-08-03 09:25:10] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=100000, type=CONSUMPTION, allocation ID=76
[2025-08-03 09:25:10] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-03 09:25:10] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040512-HSarein-0001-1754200510 created. Invalidating cache for allocation 76
[2025-08-03 09:25:11] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-03 09:25:11] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-03 09:25:11] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'budget_transfers_22_no_filters', 'free_budget_76', 'project_remaining_budget_8', 'returned_budgets_22_all_no_filters'}
[2025-08-03 09:25:11] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 77
[2025-08-03 09:25:11] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-08-03 09:25:11] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-03 15:28:00] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=500, type=CONSUMPTION, allocation ID=76
[2025-08-03 15:28:00] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=500, type=CONSUMPTION, allocation ID=76
[2025-08-03 15:28:00] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-03 15:28:00] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040512-HSarein-0002-1754222280 created. Invalidating cache for allocation 76
[2025-08-03 15:28:00] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-03 15:28:00] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-03 15:28:00] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_22_all_no_filters', 'budget_transfers_22_no_filters', 'free_budget_76', 'project_remaining_budget_8'}
[2025-08-03 15:28:00] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 78
[2025-08-03 15:28:00] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-08-03 15:28:00] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-04 13:53:37] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=5000, type=CONSUMPTION, allocation ID=76
[2025-08-04 13:53:37] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=5000, type=CONSUMPTION, allocation ID=76
[2025-08-04 13:53:37] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-04 13:53:37] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FAC-FAC-TNKH-14040430-HSarein-HSAR-Flor3-001-14040513-HSarein-0001-1754303017 created. Invalidating cache for allocation 76
[2025-08-04 13:53:37] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-04 13:53:37] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-04 13:53:37] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'budget_transfers_22_no_filters', 'free_budget_76', 'returned_budgets_22_all_no_filters', 'project_remaining_budget_8'}
[2025-08-04 13:53:37] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 79
[2025-08-04 13:53:37] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 22: is_active=True, is_completed=False
[2025-08-04 13:53:37] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماهه ابتدای سال 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-04 22:24:38] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=10000, type=CONSUMPTION, allocation ID=76
[2025-08-04 22:24:38] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=10000, type=CONSUMPTION, allocation ID=76
[2025-08-04 22:24:38] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-04 22:24:38] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FACTOR-NEW-38-1754333678.374856 created. Invalidating cache for allocation 76
[2025-08-04 22:24:38] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-04 22:24:38] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-04 22:24:38] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_76', 'budget_transfers_22_no_filters', 'returned_budgets_22_all_no_filters', 'project_remaining_budget_8'}
[2025-08-04 22:24:38] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 80
[2025-08-04 22:30:36] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=1111, type=CONSUMPTION, allocation ID=76
[2025-08-04 22:30:36] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=1111, type=CONSUMPTION, allocation ID=76
[2025-08-04 22:30:36] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-04 22:30:36] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FACTOR-NEW-39-1754334036.338245 created. Invalidating cache for allocation 76
[2025-08-04 22:30:36] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-04 22:30:36] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-04 22:30:36] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_76', 'returned_budgets_22_all_no_filters', 'budget_transfers_22_no_filters', 'project_remaining_budget_8'}
[2025-08-04 22:30:36] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 81
[2025-08-04 22:31:21] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=100000, type=CONSUMPTION, allocation ID=76
[2025-08-04 22:31:21] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=100000, type=CONSUMPTION, allocation ID=76
[2025-08-04 22:31:21] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-04 22:31:21] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FACTOR-NEW-40-1754334081.118672 created. Invalidating cache for allocation 76
[2025-08-04 22:31:21] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-04 22:31:21] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-04 22:31:21] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_22_all_no_filters', 'free_budget_76', 'project_remaining_budget_8', 'budget_transfers_22_no_filters'}
[2025-08-04 22:31:21] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 82
[2025-08-05 10:12:03] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=50000, type=CONSUMPTION, allocation ID=76
[2025-08-05 10:12:03] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=50000, type=CONSUMPTION, allocation ID=76
[2025-08-05 10:12:03] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-05 10:12:03] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FACTOR-NEW-41-1754376123.615708 created. Invalidating cache for allocation 76
[2025-08-05 10:12:03] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-05 10:12:03] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-05 10:12:03] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'budget_transfers_22_no_filters', 'project_remaining_budget_8', 'free_budget_76', 'returned_budgets_22_all_no_filters'}
[2025-08-05 10:12:03] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 83
[2025-08-05 12:55:03] DEBUG [budgets.models:549] save - Starting save for BudgetTransaction: amount=289, type=CONSUMPTION, allocation ID=76
[2025-08-05 12:55:03] DEBUG [budgets.models:538] clean - Cleaning BudgetTransaction: amount=289, type=CONSUMPTION, allocation ID=76
[2025-08-05 12:55:03] INFO [budgets.models:545] clean - BudgetTransaction validated successfully for allocation ID: 76
[2025-08-05 12:55:03] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-FACTOR-NEW-42-1754385903.542626 created. Invalidating cache for allocation 76
[2025-08-05 12:55:03] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 12:55:03] DEBUG [budgets.signals:37] update_remaining_amount - Updated remaining_budget for Tankhah 5
[2025-08-05 12:55:03] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'budget_transfers_22_no_filters', 'returned_budgets_22_all_no_filters', 'project_remaining_budget_8', 'free_budget_76'}
[2025-08-05 12:55:03] INFO [budgets.models:559] save - BudgetTransaction saved with ID: 84
[2025-08-05 13:49:13] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-05 13:59:02] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 13:59:14] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 13:59:19] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 14:27:57] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 14:48:08] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 14:49:29] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_22_no_filters', 'free_budget_76'}
[2025-08-05 15:08:55] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-05 15:10:49] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_76', 'tankhah_report_22_no_filters'}
[2025-08-09 09:19:25] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=80000000000, remaining=56000000000.00
[2025-08-09 09:19:25] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x0000029141AFEA50>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000002914190F620>, 'total_sum': Decimal('80000000000'), 'total_remaining': Decimal('56000000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:19:27] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:19:27] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-08-09 09:19:27] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 22
[2025-08-09 09:19:27] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-08-09 09:19:27] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:19:27] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:19:27] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 22
[2025-08-09 09:19:27] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=22, name=شش ماهه ابتدای سال 1404
[2025-08-09 09:19:27] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=80000000000, remaining=56000000000.00
[2025-08-09 09:19:27] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-08-09 09:19:29] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 09:19:30] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x0000029141E28690>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x0000029141AFF0E0>, 'total_budget': Decimal('80000000000'), 'remaining_budget': Decimal('56000000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماهه ابتدای سال 1404 - بازسازی مراکز - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - پژوهش - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماهه ابتدای سال 1404 - سازه جدید - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماهه ابتدای سال 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': 'شش ماهه ابتدای سال 1404', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:19:45] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=0, remaining=0
[2025-08-09 09:19:45] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000291418F9D10>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_periods': <QuerySet []>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x00000291418FA0D0>, 'total_sum': Decimal('0'), 'total_remaining': Decimal('0'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 0, 'locked': 0, 'completed': 0, 'total': 0}, 'result_count': 0}
[2025-08-09 09:19:48] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:19:48] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:100] __init__ - Set default dates for new instance: start=1404/01/01, end=1404/12/29
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:100] __init__ - Set default dates for new instance: start=1404/01/01, end=1404/12/29
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:182] clean_organization - Cleaning organization: input=HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:110] clean_start_date - Cleaning start_date: input=1404/01/01
[2025-08-09 09:20:21] ERROR [budgets.BudgetPeriod.Forms_BudgetPeriod:120] clean_start_date - Error parsing start_date: parse_jalali_date() got an unexpected keyword argument 'field_name'
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:125] clean_end_date - Cleaning end_date: input=1404/06/31
[2025-08-09 09:20:21] ERROR [budgets.BudgetPeriod.Forms_BudgetPeriod:135] clean_end_date - Error parsing end_date: parse_jalali_date() got an unexpected keyword argument 'field_name'
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:140] clean_total_amount - Cleaning total_amount: input=8500000000
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:149] clean_total_amount - Validated total_amount: 8500000000, words: 
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:154] clean_locked_percentage - Cleaning locked_percentage: input=1
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:161] clean_locked_percentage - Validated locked_percentage: 1
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:166] clean_warning_threshold - Cleaning warning_threshold: input=10.00
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:177] clean_warning_threshold - Validated warning_threshold: 10.00
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:190] clean - Running clean method: cleaned_data={'organization': <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>, 'name': 'شش ماه اول سال شمسی 1404', 'total_amount': Decimal('8500000000'), 'is_active': True, 'is_archived': False, 'is_completed': False, 'lock_condition': 'AFTER_DATE', 'locked_percentage': 1, 'warning_threshold': Decimal('10.00'), 'warning_action': 'NOTIFY', 'description': ''}
[2025-08-09 09:20:21] WARNING [budgets.BudgetPeriod.Forms_BudgetPeriod:216] clean - Missing dates: start_date=None, end_date=None
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:226] clean - Validated name uniqueness
[2025-08-09 09:20:21] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:228] clean - Clean method completed successfully
[2025-08-09 09:20:21] ERROR [budgets.BudgetPeriod.views_BudgetPeriod:55] form_invalid - Form invalid: errors={"start_date": [{"message": "\u0641\u0631\u0645\u062a \u062a\u0627\u0631\u06cc\u062e \u0634\u0631\u0648\u0639 \u0646\u0627\u0645\u0639\u062a\u0628\u0631 \u0627\u0633\u062a.", "code": ""}], "end_date": [{"message": "\u0641\u0631\u0645\u062a \u062a\u0627\u0631\u06cc\u062e \u067e\u0627\u06cc\u0627\u0646 \u0646\u0627\u0645\u0639\u062a\u0628\u0631 \u0627\u0633\u062a.", "code": ""}]}
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:100] __init__ - Set default dates for new instance: start=1404/01/01, end=1404/12/29
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:189] clean_organization - Cleaning organization: input=HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:132] clean_end_date - Cleaning end_date: input=1404/06/31
[2025-08-09 09:22:12] ERROR [budgets.BudgetPeriod.Forms_BudgetPeriod:142] clean_end_date - Error parsing end_date: parse_jalali_date() got an unexpected keyword argument 'field_name'
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:147] clean_total_amount - Cleaning total_amount: input=8500000000
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:156] clean_total_amount - Validated total_amount: 8500000000, words: 
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:161] clean_locked_percentage - Cleaning locked_percentage: input=1
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:168] clean_locked_percentage - Validated locked_percentage: 1
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:173] clean_warning_threshold - Cleaning warning_threshold: input=10.00
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:184] clean_warning_threshold - Validated warning_threshold: 10.00
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:197] clean - Running clean method: cleaned_data={'organization': <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>, 'name': 'شش ماه اول سال شمسی 1404', 'start_date': datetime.datetime(2025, 3, 21, 0, 0, tzinfo=zoneinfo.ZoneInfo(key='Asia/Tehran')), 'total_amount': Decimal('8500000000'), 'is_active': True, 'is_archived': False, 'is_completed': False, 'lock_condition': 'AFTER_DATE', 'locked_percentage': 1, 'warning_threshold': Decimal('10.00'), 'warning_action': 'NOTIFY', 'description': ''}
[2025-08-09 09:22:12] WARNING [budgets.BudgetPeriod.Forms_BudgetPeriod:223] clean - Missing dates: start_date=2025-03-21 00:00:00+03:30, end_date=None
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:233] clean - Validated name uniqueness
[2025-08-09 09:22:12] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:235] clean - Clean method completed successfully
[2025-08-09 09:22:12] ERROR [budgets.BudgetPeriod.views_BudgetPeriod:55] form_invalid - Form invalid: errors={"end_date": [{"message": "\u0641\u0631\u0645\u062a \u062a\u0627\u0631\u06cc\u062e \u067e\u0627\u06cc\u0627\u0646 \u0646\u0627\u0645\u0639\u062a\u0628\u0631 \u0627\u0633\u062a.", "code": ""}]}
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:100] __init__ - Set default dates for new instance: start=1404/01/01, end=1404/12/29
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:166] clean_organization - Cleaning organization: input=HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:124] clean_total_amount - Cleaning total_amount: input=8500000000
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:133] clean_total_amount - Validated total_amount: 8500000000, words: 
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:138] clean_locked_percentage - Cleaning locked_percentage: input=1
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:145] clean_locked_percentage - Validated locked_percentage: 1
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:150] clean_warning_threshold - Cleaning warning_threshold: input=10.00
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:161] clean_warning_threshold - Validated warning_threshold: 10.00
[2025-08-09 09:22:32] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:174] clean - Running clean method: cleaned_data={'organization': <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>, 'name': 'شش ماه اول سال شمسی 1404', 'start_date': datetime.datetime(2025, 3, 21, 0, 0, tzinfo=zoneinfo.ZoneInfo(key='Asia/Tehran')), 'end_date': datetime.datetime(2025, 9, 22, 0, 0, tzinfo=zoneinfo.ZoneInfo(key='Asia/Tehran')), 'total_amount': Decimal('8500000000'), 'is_active': True, 'is_archived': False, 'is_completed': False, 'lock_condition': 'AFTER_DATE', 'locked_percentage': 1, 'warning_threshold': Decimal('10.00'), 'warning_action': 'NOTIFY', 'description': ''}
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:198] clean - Validated date comparison
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:210] clean - Validated name uniqueness
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:212] clean - Clean method completed successfully
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:216] save - Saving BudgetPeriodForm
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:222] save - Set created_by: admin
[2025-08-09 09:22:33] DEBUG [budgets.models:97] save - Starting save for BudgetPeriod (pk=None)
[2025-08-09 09:22:33] INFO [budgets.models:102] save - BudgetPeriod saved with ID: 23
[2025-08-09 09:22:33] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:22:33] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 09:22:33] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:22:33] INFO [budgets.BudgetPeriod.Forms_BudgetPeriod:226] save - BudgetPeriod saved: شش ماه اول سال شمسی 1404 (HQ_ITDC)
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8500000000
[2025-08-09 09:22:33] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F220E6F8C0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001F220C9DE80>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8500000000'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:22:38] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 09:22:38] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F221099BD0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001F220C9DE80>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet []>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': 'شش ماه اول سال شمسی 1404', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:22:43] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:22:43] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:22:43] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:22:43] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:22:43] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:22:43] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:22:43] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:22:43] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:22:43] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=8500000000, remaining=8500000000.00
[2025-08-09 09:22:43] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-08-09 09:22:57] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:22:57] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:100] __init__ - Set default dates for new instance: start=1404/01/01, end=1404/12/29
[2025-08-09 09:23:04] DEBUG [budgets.Budget_Items.frosm_BudgetItem:80] __init__ - BudgetItemForm initialized with 7 organizations
[2025-08-09 09:23:04] DEBUG [budgets.Budget_Items.views_Budget_item:215] get_context_data - BudgetItemCreateView context: {'form': <BudgetItemForm bound=False, valid=False, fields=(budget_period;organization;name;code;is_active)>, 'view': <budgets.Budget_Items.views_Budget_item.BudgetItemCreateView object at 0x000001F22105E7B0>, 'title': 'ایجاد ردیف بودجه جدید', 'page_title': 'مدیریت ردیف\u200cهای بودجه', 'page_subtitle': 'ایجاد ردیف بودجه جدید', 'help_texts': {'budget_period': 'دوره بودجه مربوطه را انتخاب نمایید', 'organization': 'سازمان/شعبه مرتبط (اختیاری، به\u200cطور خودکار از دوره بودجه تنظیم می\u200cشود)', 'code': 'کد منحصر به فرد برای ردیف بودجه', 'name': 'نام توصیفی برای ردیف بودجه'}, 'action_buttons': [{'text': 'بازگشت به لیست', 'url': '/budgets/budgetitems/', 'icon': 'fa fa-arrow-right', 'class': 'btn btn-outline-secondary'}, {'text': 'ذخیره و ادامه', 'type': 'submit', 'name': 'save_and_continue', 'icon': 'fa fa-save', 'class': 'btn btn-outline-primary'}, {'text': 'ذخیره', 'type': 'submit', 'icon': 'fa fa-check', 'class': 'btn btn-primary'}], 'use_card': True, 'use_select2': True, 'use_jalali_datepicker': False, 'use_form_validation': True}
[2025-08-09 09:23:18] DEBUG [budgets.Budget_Items.frosm_BudgetItem:80] __init__ - BudgetItemForm initialized with 7 organizations
[2025-08-09 09:23:18] DEBUG [budgets.Budget_Items.frosm_BudgetItem:105] clean - Set default organization to HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)
[2025-08-09 09:23:20] DEBUG [budgets.Budget_Items.frosm_BudgetItem:80] __init__ - BudgetItemForm initialized with 7 organizations
[2025-08-09 09:23:20] DEBUG [budgets.Budget_Items.views_Budget_item:215] get_context_data - BudgetItemCreateView context: {'form': <BudgetItemForm bound=False, valid=False, fields=(budget_period;organization;name;code;is_active)>, 'view': <budgets.Budget_Items.views_Budget_item.BudgetItemCreateView object at 0x000001F2213FDF90>, 'title': 'ایجاد ردیف بودجه جدید', 'page_title': 'مدیریت ردیف\u200cهای بودجه', 'page_subtitle': 'ایجاد ردیف بودجه جدید', 'help_texts': {'budget_period': 'دوره بودجه مربوطه را انتخاب نمایید', 'organization': 'سازمان/شعبه مرتبط (اختیاری، به\u200cطور خودکار از دوره بودجه تنظیم می\u200cشود)', 'code': 'کد منحصر به فرد برای ردیف بودجه', 'name': 'نام توصیفی برای ردیف بودجه'}, 'action_buttons': [{'text': 'بازگشت به لیست', 'url': '/budgets/budgetitems/', 'icon': 'fa fa-arrow-right', 'class': 'btn btn-outline-secondary'}, {'text': 'ذخیره و ادامه', 'type': 'submit', 'name': 'save_and_continue', 'icon': 'fa fa-save', 'class': 'btn btn-outline-primary'}, {'text': 'ذخیره', 'type': 'submit', 'icon': 'fa fa-check', 'class': 'btn btn-primary'}], 'use_card': True, 'use_select2': True, 'use_jalali_datepicker': False, 'use_form_validation': True}
[2025-08-09 09:23:31] DEBUG [budgets.Budget_Items.frosm_BudgetItem:80] __init__ - BudgetItemForm initialized with 7 organizations
[2025-08-09 09:23:31] DEBUG [budgets.Budget_Items.frosm_BudgetItem:105] clean - Set default organization to HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)
[2025-08-09 09:23:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 09:23:40] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F22157F1D0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001F22109BED0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:23:46] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:23:46] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: None
[2025-08-09 09:23:46] WARNING [budgets.BudgetAllocation.views_BudgetAllocation:474] _get_budget_period - No budget_period_id provided
[2025-08-09 09:23:46] WARNING [budgets.BudgetAllocation.views_BudgetAllocation:531] get_form_kwargs - No valid budget period for form
[2025-08-09 09:23:46] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:23:46] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:23:46] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: None
[2025-08-09 09:23:46] WARNING [budgets.BudgetAllocation.views_BudgetAllocation:474] _get_budget_period - No budget_period_id provided
[2025-08-09 09:23:46] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-08-09 09:23:49] DEBUG [budgets.Payee.view_Payee:42] get_context_data - PayeeListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F2214438A0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<Payee: توحید (EMPLOYEE)>]>, 'payees': <QuerySet [<Payee: توحید (EMPLOYEE)>]>, 'view': <budgets.Payee.view_Payee.PayeeListView object at 0x000001F220C9DE80>, 'query': '', 'payee_type': '', 'payee_types': (('VENDOR', 'فروشنده'), ('EMPLOYEE', 'کارمند'), ('OTHER', 'دیگر'))}
[2025-08-09 09:23:54] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 09:23:54] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F221443CE0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001F220E642D0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:24:33] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 09:24:33] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F220DB60B0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001F2214729E0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:24:35] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8500000000
[2025-08-09 09:24:35] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001F2214534D0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001F22109BED0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8500000000'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:24:37] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:24:37] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:95] __init__ - Set initial dates: start_date=1404/01/01, end_date=1404/06/31
[2025-08-09 09:24:37] INFO [budgets.BudgetPeriod.Forms_BudgetPeriod:106] __init__ -  self.total_amount_words  IS 
[2025-08-09 09:24:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:24:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:24:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:24:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:24:39] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:24:39] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:24:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:24:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:24:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=8500000000, remaining=8500000000.00
[2025-08-09 09:24:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-08-09 09:24:56] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:24:56] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:24:56] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:24:56] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:24:56] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:24:56] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:24:56] ERROR [budgets.BudgetAllocation.forms_BudgetAllocation:542] clean_allocation_date - Unexpected error parsing allocation_date '1404/05/18': parse_jalali_date() got an unexpected keyword argument 'field_name'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\forms_BudgetAllocation.py", line 536, in clean_allocation_date
    parsed_date = parse_jalali_date(str(date_str), field_name=_('تاریخ تخصیص'))
                  ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: parse_jalali_date() got an unexpected keyword argument 'field_name'
[2025-08-09 09:24:56] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:602] clean - Converted percent to amount: 2550000000.0
[2025-08-09 09:24:56] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=2550000000.0, allocation_type=percent
[2025-08-09 09:24:56] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:24:56] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=2550000000.0, allocation_type=percent
[2025-08-09 09:24:56] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:24:56] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:568] form_invalid - Form invalid: errors={"allocation_date": [{"message": "\u0641\u0631\u0645\u062a \u062a\u0627\u0631\u06cc\u062e \u062a\u062e\u0635\u06cc\u0635 \u0646\u0627\u0645\u0639\u062a\u0628\u0631 \u0627\u0633\u062a.", "code": ""}]}
[2025-08-09 09:24:56] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:24:56] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:24:56] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=8500000000, remaining=8500000000.00
[2025-08-09 09:24:56] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-08-09 09:25:41] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:25:41] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:25:41] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:25:41] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:25:41] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:25:41] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:25:41] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 2550000000.0
[2025-08-09 09:31:23] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:31:23] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:31:23] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:31:23] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:31:23] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:31:23] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:31:23] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 2550000000.0
[2025-08-09 09:31:23] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=2550000000.0, allocation_type=percent
[2025-08-09 09:31:23] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:31:23] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=2550000000.0, allocation_type=percent
[2025-08-09 09:31:23] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:31:23] INFO [budgets.BudgetAllocation.views_BudgetAllocation:544] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 09:31:23] DEBUG [budgets.models:418] save - Starting save for BudgetAllocation (pk=None, allocated_amount=2550000000.0)
[2025-08-09 09:31:23] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=2550000000.0, allocation_type=percent
[2025-08-09 09:31:23] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:31:23] ERROR [budgets.models:414] update_lock_status - Error in update_lock_status for BudgetAllocation unsaved: Model instances passed to related filters must be saved.
[2025-08-09 09:31:23] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=2550000000.00 for BudgetPeriod 23
[2025-08-09 09:31:23] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'free_budget_78', 'tankhah_report_23_no_filters', 'budget_transfers_23_no_filters'}
[2025-08-09 09:31:23] INFO [budgets.models:426] save - BudgetAllocation saved with ID: 78
[2025-08-09 09:31:23] DEBUG [budgets.models:428] save - Allocation status: normal, message: وضعیت عادی
[2025-08-09 09:31:23] DEBUG [budgets.models:97] save - Starting save for BudgetPeriod (pk=23)
[2025-08-09 09:31:23] INFO [budgets.models:102] save - BudgetPeriod saved with ID: 23
[2025-08-09 09:31:23] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:31:23] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 09:31:23] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:31:23] INFO [budgets.BudgetAllocation.views_BudgetAllocation:555] form_valid - BudgetAllocation created with ID: 78
[2025-08-09 09:31:23] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 09:31:23] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000290F6913CB0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 2,550,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 2,550,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x00000290F69138C0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('5950000000.00'), 'total_allocated': Decimal('2550000000.00'), 'allocated_percentage': Decimal('30.00'), 'remaining_percentage': Decimal('70.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:31:29] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=0 for BudgetPeriod 23
[2025-08-09 09:31:29] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'free_budget_78', 'tankhah_report_23_no_filters', 'budget_transfers_23_no_filters'}
[2025-08-09 09:31:30] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 09:31:30] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000290F6BA20D0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x00000290F6BA2710>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:31:32] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8500000000
[2025-08-09 09:31:32] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000290F6941BD0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x00000290F69134D0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8500000000'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:31:34] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:31:34] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:95] __init__ - Set initial dates: start_date=1404/01/01, end_date=1404/06/31
[2025-08-09 09:31:34] INFO [budgets.BudgetPeriod.Forms_BudgetPeriod:106] __init__ -  self.total_amount_words  IS 
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:95] __init__ - Set initial dates: start_date=1404/01/01, end_date=1404/06/31
[2025-08-09 09:31:42] INFO [budgets.BudgetPeriod.Forms_BudgetPeriod:106] __init__ -  self.total_amount_words  IS 
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:166] clean_organization - Cleaning organization: input=HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:124] clean_total_amount - Cleaning total_amount: input=8500000000
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:133] clean_total_amount - Validated total_amount: 8500000000, words: 
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:138] clean_locked_percentage - Cleaning locked_percentage: input=1
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:145] clean_locked_percentage - Validated locked_percentage: 1
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:150] clean_warning_threshold - Cleaning warning_threshold: input=10.00
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:161] clean_warning_threshold - Validated warning_threshold: 10.00
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:174] clean - Running clean method: cleaned_data={'organization': <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>, 'name': 'شش ماه اول سال شمسی 1404', 'start_date': datetime.datetime(2025, 3, 21, 0, 0, tzinfo=zoneinfo.ZoneInfo(key='Asia/Tehran')), 'end_date': datetime.datetime(2025, 9, 22, 0, 0, tzinfo=zoneinfo.ZoneInfo(key='Asia/Tehran')), 'total_amount': Decimal('8500000000'), 'is_active': True, 'is_archived': False, 'is_completed': False, 'lock_condition': 'AFTER_DATE', 'locked_percentage': 1, 'warning_threshold': Decimal('10.00'), 'warning_action': 'NOTIFY', 'description': ''}
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:198] clean - Validated date comparison
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:210] clean - Validated name uniqueness
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:212] clean - Clean method completed successfully
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:216] save - Saving BudgetPeriodForm
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:222] save - Set created_by: admin
[2025-08-09 09:31:42] DEBUG [budgets.models:97] save - Starting save for BudgetPeriod (pk=23)
[2025-08-09 09:31:42] INFO [budgets.models:102] save - BudgetPeriod saved with ID: 23
[2025-08-09 09:31:42] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:31:42] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 09:31:42] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:31:42] INFO [budgets.BudgetPeriod.Forms_BudgetPeriod:226] save - BudgetPeriod saved: شش ماه اول سال شمسی 1404 (HQ_ITDC)
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8500000000
[2025-08-09 09:31:42] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000290F6BABE10>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x00000290F6BA34D0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8500000000'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:31:45] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:31:45] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:31:45] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:31:45] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:31:45] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:31:45] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:31:45] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:31:45] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:31:45] INFO [budgets.BudgetAllocation.views_BudgetAllocation:508] get_context_data - Budget period data: total=8500000000, remaining=8500000000.00
[2025-08-09 09:31:45] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:522] get_context_data - Loaded 5 projects
[2025-08-09 09:32:21] INFO [budgets.BudgetAllocation.views_BudgetAllocation:540] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:32:21] INFO [budgets.BudgetAllocation.views_BudgetAllocation:465] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:32:21] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:472] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:32:21] INFO [budgets.BudgetAllocation.views_BudgetAllocation:478] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:32:21] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:32:21] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:32:21] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 425000000.00
[2025-08-09 09:32:21] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=425000000.00, allocation_type=percent
[2025-08-09 09:32:21] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:32:21] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=425000000.00, allocation_type=percent
[2025-08-09 09:32:21] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:32:21] INFO [budgets.BudgetAllocation.views_BudgetAllocation:544] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 09:32:21] DEBUG [budgets.models:418] save - Starting save for BudgetAllocation (pk=None, allocated_amount=425000000.00)
[2025-08-09 09:32:21] DEBUG [budgets.models:292] clean - Cleaning BudgetAllocation: allocated_amount=425000000.00, allocation_type=percent
[2025-08-09 09:32:21] DEBUG [budgets.models:340] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 09:32:21] ERROR [budgets.models:414] update_lock_status - Error in update_lock_status for BudgetAllocation unsaved: Model instances passed to related filters must be saved.
[2025-08-09 09:32:21] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=425000000.00 for BudgetPeriod 23
[2025-08-09 09:32:21] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'project_remaining_budget_8', 'tankhah_report_23_no_filters', 'free_budget_79', 'budget_transfers_23_no_filters'}
[2025-08-09 09:32:21] INFO [budgets.models:426] save - BudgetAllocation saved with ID: 79
[2025-08-09 09:32:21] DEBUG [budgets.models:428] save - Allocation status: normal, message: وضعیت عادی
[2025-08-09 09:32:21] DEBUG [budgets.models:97] save - Starting save for BudgetPeriod (pk=23)
[2025-08-09 09:32:21] INFO [budgets.models:102] save - BudgetPeriod saved with ID: 23
[2025-08-09 09:32:21] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:32:21] DEBUG [budgets.models:171] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 09:32:21] DEBUG [budgets.models:142] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 09:32:21] INFO [budgets.BudgetAllocation.views_BudgetAllocation:555] form_valid - BudgetAllocation created with ID: 79
[2025-08-09 09:32:21] INFO [budgets.BudgetAllocation.views_BudgetAllocation:183] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 09:32:21] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:364] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000290F689CC30>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x00000290F6CA42D0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8075000000.00'), 'total_allocated': Decimal('425000000.00'), 'allocated_percentage': Decimal('5.00'), 'remaining_percentage': Decimal('95.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 09:33:09] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8075000000.00
[2025-08-09 09:33:09] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x00000290F6887890>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x00000290F6942990>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8075000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:33:54] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 09:33:54] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:33:54] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:33:54] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:33:54] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 09:33:54] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 09:33:54] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 09:33:54] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 09:33:54] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=8075000000.00
[2025-08-09 09:33:54] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 09:33:56] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:79] __init__ - Initializing BudgetPeriodForm
[2025-08-09 09:33:56] DEBUG [budgets.BudgetPeriod.Forms_BudgetPeriod:95] __init__ - Set initial dates: start_date=1404/01/01, end_date=1404/06/31
[2025-08-09 09:33:56] INFO [budgets.BudgetPeriod.Forms_BudgetPeriod:106] __init__ -  self.total_amount_words  IS 
[2025-08-09 09:34:52] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8075000000.00
[2025-08-09 09:34:52] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001DE3DF62F90>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001DE3DB19E80>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8075000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 09:35:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 09:35:01] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001DE3DF5FED0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001DE3DF63B60>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8075000000.00'), 'total_allocated': Decimal('425000000.00'), 'allocated_percentage': Decimal('5.00'), 'remaining_percentage': Decimal('95.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 10:01:36] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 10:01:36] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000002739E976F90>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000002739E977B60>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8075000000.00'), 'total_allocated': Decimal('425000000.00'), 'allocated_percentage': Decimal('5.00'), 'remaining_percentage': Decimal('95.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 10:01:44] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 10:01:44] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000002739EB839D0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000002739E693610>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8075000000.00'), 'total_allocated': Decimal('425000000.00'), 'allocated_percentage': Decimal('5.00'), 'remaining_percentage': Decimal('95.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 12:47:30] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 12:47:30] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001EA379F9160>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001EA3786F0E0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8075000000.00'), 'total_allocated': Decimal('425000000.00'), 'allocated_percentage': Decimal('5.00'), 'remaining_percentage': Decimal('95.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:07:18] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 15:07:18] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001D7B62FAA50>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001D7B5EEDFD0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8075000000.00'), 'total_allocated': Decimal('425000000.00'), 'allocated_percentage': Decimal('5.00'), 'remaining_percentage': Decimal('95.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:07:21] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=0 for BudgetPeriod 23
[2025-08-09 15:07:21] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'project_remaining_budget_8', 'tankhah_report_23_no_filters', 'budget_transfers_23_no_filters', 'free_budget_79'}
[2025-08-09 15:07:22] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 15:07:22] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001D7B64F96D0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001D7B64F9BD0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:07:24] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8500000000
[2025-08-09 15:07:24] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001D7B64FB890>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001D7B62FACF0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8500000000'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 15:07:31] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:07:31] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:07:31] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:07:31] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:07:31] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:07:31] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:07:31] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:07:31] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:07:31] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=8500000000
[2025-08-09 15:07:31] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:08:09] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:08:09] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:08:09] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:08:09] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:08:09] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:08:09] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:08:09] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 4250000000.0
[2025-08-09 15:08:09] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:08:09] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:08:09] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:08:09] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:08:09] INFO [budgets.BudgetAllocation.views_BudgetAllocation:414] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 15:08:09] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=4250000000.00 for BudgetPeriod 23
[2025-08-09 15:08:09] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'free_budget_80', 'project_remaining_budget_8', 'tankhah_report_23_no_filters', 'budget_transfers_23_no_filters'}
[2025-08-09 15:08:09] INFO [budgets.signals:155] create_initial_allocation_transaction - BudgetAllocation PK 80 was created. Creating initial budget transaction.
[2025-08-09 15:08:09] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:433] form_valid - Unexpected error saving budget allocation: BudgetTransaction() got unexpected keyword arguments: 'trigger_obj'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\views_BudgetAllocation.py", line 424, in form_valid
    response = super().form_valid(form)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\views\generic\edit.py", line 133, in form_valid
    self.object = form.save()
                  ~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\forms_BudgetAllocation.py", line 659, in save
    instance = super().save(commit=commit)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\forms\models.py", line 554, in save
    self.instance.save()
    ~~~~~~~~~~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 468, in save
    super().save(*args, **kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\db\models\base.py", line 892, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\db\models\base.py", line 1013, in save_base
    post_save.send(
    ~~~~~~~~~~~~~~^
        sender=origin,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        using=using,
        ^^^^^^^^^^^^
    )
    ^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\dispatch\dispatcher.py", line 189, in send
    response = receiver(signal=self, sender=sender, **named)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\signals.py", line 163, in create_initial_allocation_transaction
    create_budget_transaction(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        budget_source_obj=instance,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
        trigger_obj=None  # این تراکنش توسط خودش ایجاد شده
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\budget_calculations.py", line 1380, in create_budget_transaction
    transaction = BudgetTransaction(
        allocation=budget_source_obj if isinstance(budget_source_obj, BudgetAllocation) else None,
    ...<5 lines>...
        trigger_obj=trigger_obj
    )
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\db\models\base.py", line 567, in __init__
    raise TypeError(
    ...<2 lines>...
    )
TypeError: BudgetTransaction() got unexpected keyword arguments: 'trigger_obj'
[2025-08-09 15:08:09] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:438] form_invalid - Form invalid: errors={"__all__": [{"message": "\u062e\u0637\u0627\u06cc\u06cc \u062f\u0631 \u062b\u0628\u062a \u062a\u062e\u0635\u06cc\u0635 \u0628\u0648\u062f\u062c\u0647 \u0631\u062e \u062f\u0627\u062f: BudgetTransaction() got unexpected keyword arguments: 'trigger_obj'", "code": ""}]}
[2025-08-09 15:08:09] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:08:09] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:08:09] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=8500000000
[2025-08-09 15:08:09] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:09:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:09:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:09:01] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:09:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:09:01] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:09:01] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:09:01] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 4250000000.0
[2025-08-09 15:09:01] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:09:01] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:09:01] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:09:01] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:09:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:414] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 15:09:01] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=4250000000.00 for BudgetPeriod 23
[2025-08-09 15:09:01] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'free_budget_81', 'budget_transfers_23_no_filters', 'tankhah_report_23_no_filters'}
[2025-08-09 15:09:01] INFO [budgets.signals:155] create_initial_allocation_transaction - BudgetAllocation PK 81 was created. Creating initial budget transaction.
[2025-08-09 15:09:01] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:433] form_valid - Unexpected error saving budget allocation: 'NoneType' object has no attribute 'name'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\views_BudgetAllocation.py", line 424, in form_valid
    response = super().form_valid(form)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\views\generic\edit.py", line 133, in form_valid
    self.object = form.save()
                  ~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\forms_BudgetAllocation.py", line 659, in save
    instance = super().save(commit=commit)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\forms\models.py", line 554, in save
    self.instance.save()
    ~~~~~~~~~~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 468, in save
    super().save(*args, **kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\db\models\base.py", line 892, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\db\models\base.py", line 1013, in save_base
    post_save.send(
    ~~~~~~~~~~~~~~^
        sender=origin,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        using=using,
        ^^^^^^^^^^^^
    )
    ^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\dispatch\dispatcher.py", line 189, in send
    response = receiver(signal=self, sender=sender, **named)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\signals.py", line 168, in create_initial_allocation_transaction
    description=f"اعتبار اولیه تخصیص بودجه برای پروژه {instance.project.name}",
                                                       ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'name'
[2025-08-09 15:09:01] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:438] form_invalid - Form invalid: errors={"__all__": [{"message": "\u062e\u0637\u0627\u06cc\u06cc \u062f\u0631 \u062b\u0628\u062a \u062a\u062e\u0635\u06cc\u0635 \u0628\u0648\u062f\u062c\u0647 \u0631\u062e \u062f\u0627\u062f: 'NoneType' object has no attribute 'name'", "code": ""}]}
[2025-08-09 15:09:01] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:09:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:09:01] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=8500000000
[2025-08-09 15:09:01] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:18:02] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:18:02] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:18:02] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:18:02] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:18:02] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:18:02] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:18:02] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 4250000000.0
[2025-08-09 15:18:02] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:18:02] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:18:02] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:18:02] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:18:02] INFO [budgets.BudgetAllocation.views_BudgetAllocation:414] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 15:18:02] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=4250000000.00 for BudgetPeriod 23
[2025-08-09 15:18:02] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'free_budget_82', 'project_remaining_budget_8', 'tankhah_report_23_no_filters', 'budget_transfers_23_no_filters'}
[2025-08-09 15:18:02] INFO [budgets.signals:155] create_initial_allocation_transaction - BudgetAllocation PK 82 was created. Creating initial budget transaction.
[2025-08-09 15:18:02] DEBUG [budgets.models:598] save - Starting save for BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=82
[2025-08-09 15:18:02] DEBUG [budgets.models:587] clean - Cleaning BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=82
[2025-08-09 15:18:02] INFO [budgets.models:594] clean - BudgetTransaction validated successfully for allocation ID: 82
[2025-08-09 15:18:02] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-ALLOCATION-82-7338f7223f92 created. Invalidating cache for allocation 82
[2025-08-09 15:18:02] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_23_all_no_filters', 'free_budget_82', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 15:18:02] INFO [budgets.models:608] save - BudgetTransaction saved with ID: 85
[2025-08-09 15:18:02] INFO [budgets.models:469] save - BudgetAllocation PK 82 saved, is_new=True, old_amount=0, new_amount=4250000000.0
[2025-08-09 15:18:02] DEBUG [budgets.models:598] save - Starting save for BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=82
[2025-08-09 15:18:02] DEBUG [budgets.models:587] clean - Cleaning BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=82
[2025-08-09 15:18:02] INFO [budgets.models:594] clean - BudgetTransaction validated successfully for allocation ID: 82
[2025-08-09 15:18:02] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-ALLOCATION-82-8a1e9dde4e94 created. Invalidating cache for allocation 82
[2025-08-09 15:18:02] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_23_all_no_filters', 'free_budget_82', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 15:18:02] INFO [budgets.models:608] save - BudgetTransaction saved with ID: 86
[2025-08-09 15:18:02] INFO [budgets.models:480] save - Created ALLOCATION transaction for new BudgetAllocation PK 82
[2025-08-09 15:18:02] DEBUG [budgets.models:98] save - Starting save for BudgetPeriod (pk=23)
[2025-08-09 15:18:02] INFO [budgets.models:103] save - BudgetPeriod saved with ID: 23
[2025-08-09 15:18:02] DEBUG [budgets.models:145] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('warning', 'بودجه به آستانه هشدار رسیده است.')
[2025-08-09 15:18:02] DEBUG [budgets.models:174] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 15:18:02] DEBUG [budgets.models:145] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('warning', 'بودجه به آستانه هشدار رسیده است.')
[2025-08-09 15:18:02] ERROR [budgets.models:111] save - Error saving BudgetPeriod: 'BudgetPeriod' object has no attribute 'send_notification'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 108, in save
    self.send_notification(status, message)
    ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'BudgetPeriod' object has no attribute 'send_notification'
[2025-08-09 15:18:02] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:433] form_valid - Unexpected error saving budget allocation: 'BudgetPeriod' object has no attribute 'send_notification'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\views_BudgetAllocation.py", line 424, in form_valid
    response = super().form_valid(form)
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\venv\Lib\site-packages\django\views\generic\edit.py", line 133, in form_valid
    self.object = form.save()
                  ~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\BudgetAllocation\forms_BudgetAllocation.py", line 665, in save
    instance.budget_period.save(update_fields=['total_allocated'])
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 108, in save
    self.send_notification(status, message)
    ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'BudgetPeriod' object has no attribute 'send_notification'
[2025-08-09 15:18:02] ERROR [budgets.BudgetAllocation.views_BudgetAllocation:438] form_invalid - Form invalid: errors={"__all__": [{"message": "\u062e\u0637\u0627\u06cc\u06cc \u062f\u0631 \u062b\u0628\u062a \u062a\u062e\u0635\u06cc\u0635 \u0628\u0648\u062f\u062c\u0647 \u0631\u062e \u062f\u0627\u062f: 'BudgetPeriod' object has no attribute 'send_notification'", "code": ""}]}
[2025-08-09 15:18:02] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:18:02] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:18:02] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=8500000000
[2025-08-09 15:18:02] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:18:45] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 0 records
[2025-08-09 15:18:45] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001DED4E43A10>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet []>, 'budget_allocations': <QuerySet []>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001DED4E43B60>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('8500000000.00'), 'total_allocated': Decimal('0'), 'allocated_percentage': Decimal('0'), 'remaining_percentage': Decimal('100.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:19:01] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=8500000000
[2025-08-09 15:19:01] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001DED4F92AD0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001DED4E43E00>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('8500000000'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 15:19:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:19:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:19:04] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:19:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:19:04] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:19:04] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:19:04] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:19:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:19:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=8500000000
[2025-08-09 15:19:04] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:24:59] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:24:59] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:24:59] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:24:59] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:24:59] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:24:59] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:24:59] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 4250000000.0
[2025-08-09 15:24:59] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:24:59] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:24:59] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=4250000000.0, allocation_type=percent
[2025-08-09 15:24:59] DEBUG [budgets.models:359] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:24:59] INFO [budgets.BudgetAllocation.views_BudgetAllocation:414] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 15:24:59] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=4250000000.00 for BudgetPeriod 23
[2025-08-09 15:24:59] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'tankhah_report_23_no_filters', 'free_budget_83', 'budget_transfers_23_no_filters'}
[2025-08-09 15:24:59] INFO [budgets.signals:155] create_initial_allocation_transaction - BudgetAllocation PK 83 was created. Creating initial budget transaction.
[2025-08-09 15:24:59] DEBUG [budgets.models:598] save - Starting save for BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=83
[2025-08-09 15:24:59] INFO [budgets.models:604] save - Generated transaction_id: TX-ALLOCATION-83-aaf63c553bfb
[2025-08-09 15:24:59] DEBUG [budgets.models:587] clean - Cleaning BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=83
[2025-08-09 15:24:59] INFO [budgets.models:594] clean - BudgetTransaction validated successfully for allocation ID: 83
[2025-08-09 15:24:59] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-ALLOCATION-83-aaf63c553bfb created. Invalidating cache for allocation 83
[2025-08-09 15:24:59] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_23_all_no_filters', 'free_budget_83', 'budget_transfers_23_no_filters'}
[2025-08-09 15:24:59] INFO [budgets.models:608] save - BudgetTransaction saved with ID: 87
[2025-08-09 15:24:59] INFO [budgets.models:469] save - BudgetAllocation PK 83 saved, is_new=True, old_amount=0, new_amount=4250000000.0
[2025-08-09 15:24:59] DEBUG [budgets.models:598] save - Starting save for BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=83
[2025-08-09 15:24:59] DEBUG [budgets.models:587] clean - Cleaning BudgetTransaction: amount=4250000000.0, type=ALLOCATION, allocation ID=83
[2025-08-09 15:24:59] INFO [budgets.models:594] clean - BudgetTransaction validated successfully for allocation ID: 83
[2025-08-09 15:24:59] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-ALLOCATION-83-092d0a341263 created. Invalidating cache for allocation 83
[2025-08-09 15:24:59] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_23_all_no_filters', 'free_budget_83', 'budget_transfers_23_no_filters'}
[2025-08-09 15:24:59] INFO [budgets.models:608] save - BudgetTransaction saved with ID: 88
[2025-08-09 15:24:59] INFO [budgets.models:480] save - Created ALLOCATION transaction for new BudgetAllocation PK 83
[2025-08-09 15:24:59] DEBUG [budgets.models:98] save - Starting save for BudgetPeriod (pk=23)
[2025-08-09 15:24:59] DEBUG [budgets.models:145] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('warning', 'بودجه به آستانه هشدار رسیده است.')
[2025-08-09 15:24:59] DEBUG [budgets.models:174] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 15:24:59] DEBUG [budgets.models:145] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('warning', 'بودجه به آستانه هشدار رسیده است.')
[2025-08-09 15:24:59] INFO [budgets.models:109] save - Notification needed for status: warning - بودجه به آستانه هشدار رسیده است.
[2025-08-09 15:24:59] INFO [budgets.BudgetAllocation.views_BudgetAllocation:425] form_valid - BudgetAllocation created with ID: 83
[2025-08-09 15:24:59] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 15:24:59] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000002DB0822BE00>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000002DB07E15E80>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('4250000000.00'), 'total_allocated': Decimal('4250000000.00'), 'allocated_percentage': Decimal('50.00'), 'remaining_percentage': Decimal('50.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:36:47] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 1 records
[2025-08-09 15:36:48] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x0000017F0DA730E0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x0000017F0DA734D0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('4250000000.00'), 'total_allocated': Decimal('4250000000.00'), 'allocated_percentage': Decimal('50.00'), 'remaining_percentage': Decimal('50.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:36:52] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:498] __init__ - Set initial allocation_date from instance: 1404/05/18
[2025-08-09 15:36:52] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:37:01] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:498] __init__ - Set initial allocation_date from instance: 1404/05/18
[2025-08-09 15:37:01] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:37:09] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:498] __init__ - Set initial allocation_date from instance: 1404/05/18
[2025-08-09 15:37:09] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:37:09] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 361250000000000000.00
[2025-08-09 15:37:09] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=361250000000000000.00, allocation_type=percent
[2025-08-09 15:37:09] ERROR [budgets.BudgetAllocation.forms_BudgetAllocation:642] clean - Error in BudgetAllocationForm.clean: ['مبلغ تخصیص (361,250,000,000,000,000 ریال) بیشتر از باقی\u200cمانده دوره بودجه (4,250,000,000 ریال) است.']
[2025-08-09 15:37:09] DEBUG [budgets.models:311] clean - Cleaning BudgetAllocation: allocated_amount=361250000000000000.00, allocation_type=percent
[2025-08-09 15:37:21] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:301] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=4250000000.00
[2025-08-09 15:37:21] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:302] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x0000017F0DD77610>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x0000017F0DA72CF0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('4250000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 15:50:53] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:229] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=4250000000.00
[2025-08-09 15:50:53] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:230] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001FC224E2E40>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001FC224E2CF0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('4250000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 15:54:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:54:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:54:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:54:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:54:39] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:54:39] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:54:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:54:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:54:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=4250000000.00
[2025-08-09 15:54:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:54:53] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:54:53] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:54:53] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:54:53] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:54:53] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:54:53] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:54:53] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 850000000.0
[2025-08-09 15:54:53] DEBUG [budgets.models:344] clean - Cleaning BudgetAllocation: allocated_amount=850000000.0, allocation_type=percent
[2025-08-09 15:54:53] DEBUG [budgets.models:392] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:54:53] DEBUG [budgets.models:344] clean - Cleaning BudgetAllocation: allocated_amount=850000000.0, allocation_type=percent
[2025-08-09 15:54:53] DEBUG [budgets.models:392] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:54:53] INFO [budgets.BudgetAllocation.views_BudgetAllocation:414] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 15:54:53] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=5100000000.00 for BudgetPeriod 23
[2025-08-09 15:54:53] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'project_remaining_budget_7', 'tankhah_report_23_no_filters', 'free_budget_84', 'budget_transfers_23_no_filters'}
[2025-08-09 15:54:53] INFO [budgets.models:511] save - Creating initial ALLOCATION transaction for new BudgetAllocation PK 84
[2025-08-09 15:54:53] DEBUG [budgets.models:637] save - Starting save for BudgetTransaction: amount=850000000.0, type=ALLOCATION, allocation ID=84
[2025-08-09 15:54:53] DEBUG [budgets.models:626] clean - Cleaning BudgetTransaction: amount=850000000.0, type=ALLOCATION, allocation ID=84
[2025-08-09 15:54:53] INFO [budgets.models:633] clean - BudgetTransaction validated successfully for allocation ID: 84
[2025-08-09 15:54:53] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-ALLOCATION-84-2dcbb0da0354 created. Invalidating cache for allocation 84
[2025-08-09 15:54:53] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'project_remaining_budget_7', 'returned_budgets_23_all_no_filters', 'free_budget_84', 'budget_transfers_23_no_filters'}
[2025-08-09 15:54:53] INFO [budgets.models:647] save - BudgetTransaction saved with ID: 89
[2025-08-09 15:54:53] DEBUG [budgets.models:168] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 15:54:53] DEBUG [budgets.models:168] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 15:54:53] DEBUG [budgets.models:197] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 15:54:53] DEBUG [budgets.models:168] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 15:54:53] INFO [budgets.BudgetAllocation.views_BudgetAllocation:425] form_valid - BudgetAllocation created with ID: 84
[2025-08-09 15:54:53] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-08-09 15:54:53] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001417C3DDFD0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001417C7F3380>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('3400000000.00'), 'total_allocated': Decimal('5100000000.00'), 'allocated_percentage': Decimal('60.00'), 'remaining_percentage': Decimal('40.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:55:00] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:498] __init__ - Set initial allocation_date from instance: 1404/05/18
[2025-08-09 15:55:00] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:55:39] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 2 records
[2025-08-09 15:55:39] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001417CA13610>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001417CA13C50>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('3400000000.00'), 'total_allocated': Decimal('5100000000.00'), 'allocated_percentage': Decimal('60.00'), 'remaining_percentage': Decimal('40.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:55:46] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:229] get_context_data - BudgetPeriodListView context calculated totals: sum=8500000000, remaining=3400000000.00
[2025-08-09 15:55:46] DEBUG [budgets.BudgetPeriod.views_BudgetPeriod:230] get_context_data - BudgetPeriodListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001417CA134D0>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'view': <budgets.BudgetPeriod.views_BudgetPeriod.BudgetPeriodListView object at 0x000001417C3DDFD0>, 'total_sum': Decimal('8500000000'), 'total_remaining': Decimal('3400000000.00'), 'query': '', 'status': '', 'date_from': '', 'date_to': '', 'status_summary': {'active': 1, 'locked': 0, 'completed': 0, 'total': 1}, 'result_count': 1}
[2025-08-09 15:55:47] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:55:47] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:55:47] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:55:47] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:55:47] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:55:47] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:55:47] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:55:47] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:55:48] INFO [budgets.BudgetAllocation.views_BudgetAllocation:378] get_context_data - Budget period data: total=8500000000, remaining=3400000000.00
[2025-08-09 15:55:48] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:392] get_context_data - Loaded 5 projects
[2025-08-09 15:56:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:410] dispatch - Starting dispatch in BudgetAllocationCreateView for user: admin
[2025-08-09 15:56:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:335] get_initial - Set initial budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:56:04] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:342] _get_budget_period - Getting budget_period with ID: 23
[2025-08-09 15:56:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:348] _get_budget_period - Retrieved budget_period: ID=23, name=شش ماه اول سال شمسی 1404
[2025-08-09 15:56:04] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:504] __init__ - Set default allocation_date: 1404/05/18
[2025-08-09 15:56:04] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:518] __init__ - Organization queryset set for active, allocatable orgs.
[2025-08-09 15:56:04] DEBUG [budgets.BudgetAllocation.forms_BudgetAllocation:594] clean - Converted percent to amount: 425000000.00
[2025-08-09 15:56:04] DEBUG [budgets.models:344] clean - Cleaning BudgetAllocation: allocated_amount=425000000.00, allocation_type=percent
[2025-08-09 15:56:04] DEBUG [budgets.models:392] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:56:04] DEBUG [budgets.models:344] clean - Cleaning BudgetAllocation: allocated_amount=425000000.00, allocation_type=percent
[2025-08-09 15:56:04] DEBUG [budgets.models:392] clean - Clean validation passed (Model IS : BudgetsAllocations )
[2025-08-09 15:56:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:414] form_valid - Form valid for BudgetAllocation, saving...
[2025-08-09 15:56:04] DEBUG [budgets.signals:23] update_total_allocated - Updated total_allocated=5525000000.00 for BudgetPeriod 23
[2025-08-09 15:56:04] DEBUG [budgets.signals:72] invalidate_allocation_cache - Invalidated cache keys after BudgetAllocation change: {'free_budget_85', 'tankhah_report_23_no_filters', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 15:56:04] INFO [budgets.models:511] save - Creating initial ALLOCATION transaction for new BudgetAllocation PK 85
[2025-08-09 15:56:04] DEBUG [budgets.models:637] save - Starting save for BudgetTransaction: amount=425000000.00, type=ALLOCATION, allocation ID=85
[2025-08-09 15:56:04] DEBUG [budgets.models:626] clean - Cleaning BudgetTransaction: amount=425000000.00, type=ALLOCATION, allocation ID=85
[2025-08-09 15:56:04] INFO [budgets.models:633] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 15:56:04] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-ALLOCATION-85-c0b7f103a068 created. Invalidating cache for allocation 85
[2025-08-09 15:56:04] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_85', 'returned_budgets_23_all_no_filters', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 15:56:04] INFO [budgets.models:647] save - BudgetTransaction saved with ID: 90
[2025-08-09 15:56:04] DEBUG [budgets.models:168] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 15:56:04] DEBUG [budgets.models:168] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 15:56:04] DEBUG [budgets.models:197] update_lock_status - Updated lock status for BudgetPeriod 23: is_active=True, is_completed=False
[2025-08-09 15:56:04] DEBUG [budgets.models:168] check_budget_status_no_save - check_budget_status_no_save: obj=شش ماه اول سال شمسی 1404 (HQ_ITDC), result=('normal', 'وضعیت عادی')
[2025-08-09 15:56:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:425] form_valid - BudgetAllocation created with ID: 85
[2025-08-09 15:56:04] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 3 records
[2025-08-09 15:56:04] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001417C50EB10>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001417924E210>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('2975000000.00'), 'total_allocated': Decimal('5525000000.00'), 'allocated_percentage': Decimal('65.00'), 'remaining_percentage': Decimal('35.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:56:14] INFO [budgets.BudgetAllocation.views_BudgetAllocation:53] get_queryset - BudgetAllocationListView queryset: 3 records
[2025-08-09 15:56:14] DEBUG [budgets.BudgetAllocation.views_BudgetAllocation:234] get_context_data - BudgetAllocationListView context: {'paginator': <django.core.paginator.Paginator object at 0x000001417CA1F950>, 'page_obj': <Page 1 of 1>, 'is_paginated': False, 'object_list': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'budget_allocations': <QuerySet [<BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 4,250,000,000 ریال>, <BudgetAllocation: دفتر مرکزی شرکت توسعه گردشگری ایران - مرمت و بازسازی - 1404/05/18 - 850,000,000 ریال>, <BudgetAllocation: هتل لاله سرعین - مرمت و بازسازی - 1404/05/18 - 425,000,000 ریال>]>, 'view': <budgets.BudgetAllocation.views_BudgetAllocation.BudgetAllocationListView object at 0x000001417CA1FBB0>, 'total_budget': Decimal('8500000000'), 'remaining_budget': Decimal('2975000000.00'), 'total_allocated': Decimal('5525000000.00'), 'allocated_percentage': Decimal('65.00'), 'remaining_percentage': Decimal('35.00'), 'budget_item_data': {}, 'project_data': {}, 'budget_items': <QuerySet [<BudgetItem: شش ماه اول سال شمسی 1404 - پژوهشی - دفتر مرکزی شرکت توسعه گردشگری ایران>, <BudgetItem: شش ماه اول سال شمسی 1404 - مرمت و بازسازی - دفتر مرکزی شرکت توسعه گردشگری ایران>]>, 'organizations': <QuerySet [<Organization: HSarein - هتل لاله سرعین (هتل)>, <Organization: Htehran - هتل لاله تهران (هتل)>, <Organization: Hcha - هتل لاله چابهار (هتل)>, <Organization: Hkan - هتل لاله کندوان (هتل)>, <Organization: Hbis - هتل لاله بیستون (هتل)>, <Organization: ComplexSHC - مجتمع آبدرمانی سبلان (هتل)>, <Organization: HQ_ITDC - دفتر مرکزی شرکت توسعه گردشگری ایران (دفتر مرکزی)>]>, 'budget_periods': <QuerySet [<BudgetPeriod: شش ماه اول سال شمسی 1404 (HQ_ITDC)>]>, 'projects': <QuerySet [<Project: HQ-P001 - اجرای اتاق سرور دفتر مرکزی (فعال)>, <Project: HSAR-Flor3 - بازسازی هتل - طبقه سوم لاله سرعین (فعال)>, <Project: HKan-ServerRoom - بازسازی اتاق سرور هتل لاله کندوان (فعال)>, <Project: HSar-Engining - بازسازی تاسیسات هتل (فعال)>, <Project: HHydro-1404 - بازسازی مجتمع آبدرمانی سبلان - لوله کشی آبگرم (فعال)>]>, 'status': 'filtered', 'status_message': 'نمایش تخصیص\u200cهای فیلترشده', 'query': '', 'date_from': '', 'date_to': '', 'selected_budget_item': None, 'selected_organization': None, 'selected_budget_period': None, 'selected_project': None, 'selected_allocation_date': None}
[2025-08-09 15:56:43] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_85', 'tankhah_report_23_no_filters'}
[2025-08-09 15:56:43] DEBUG [budgets.models:637] save - Starting save for BudgetTransaction: amount=15000000, type=CONSUMPTION, allocation ID=85
[2025-08-09 15:56:43] DEBUG [budgets.models:626] clean - Cleaning BudgetTransaction: amount=15000000, type=CONSUMPTION, allocation ID=85
[2025-08-09 15:56:43] INFO [budgets.models:633] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 15:56:43] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-e74812a9e063 created. Invalidating cache for allocation 85
[2025-08-09 15:56:43] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_85', 'returned_budgets_23_all_no_filters', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 15:56:43] INFO [budgets.models:647] save - BudgetTransaction saved with ID: 91
[2025-08-09 16:05:52] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_85', 'tankhah_report_23_no_filters'}
[2025-08-09 16:05:52] DEBUG [budgets.models:639] save - Starting save for BudgetTransaction: amount=7500000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:05:52] DEBUG [budgets.models:628] clean - Cleaning BudgetTransaction: amount=7500000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:05:52] INFO [budgets.models:635] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:05:52] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-a850867e60fa created. Invalidating cache for allocation 85
[2025-08-09 16:05:52] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_85', 'returned_budgets_23_all_no_filters', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 16:05:52] INFO [budgets.models:655] save - BudgetTransaction saved with ID: 92
[2025-08-09 16:11:56] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_23_no_filters', 'free_budget_85'}
[2025-08-09 16:11:56] DEBUG [budgets.models:685] save - Starting save for BudgetTransaction: amount=750000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:11:56] DEBUG [budgets.models:689] save - Starting save for BudgetTransaction: amount=750000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:11:56] DEBUG [budgets.models:673] clean - Cleaning BudgetTransaction: amount=750000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:11:56] INFO [budgets.models:681] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:11:56] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-c2bb4da87436 created. Invalidating cache for allocation 85
[2025-08-09 16:11:56] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'returned_budgets_23_all_no_filters', 'free_budget_85', 'project_remaining_budget_8', 'budget_transfers_23_no_filters'}
[2025-08-09 16:11:56] INFO [budgets.models:704] save - BudgetTransaction saved with ID: 93
[2025-08-09 16:16:13] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_85', 'tankhah_report_23_no_filters'}
[2025-08-09 16:16:13] DEBUG [budgets.models:671] save - Starting save for BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:16:13] DEBUG [budgets.models:658] clean - Cleaning BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:16:13] INFO [budgets.models:666] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:16:13] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-15bc9a44471f created. Invalidating cache for allocation 85
[2025-08-09 16:16:13] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'project_remaining_budget_8', 'returned_budgets_23_all_no_filters', 'budget_transfers_23_no_filters', 'free_budget_85'}
[2025-08-09 16:16:13] INFO [budgets.models:686] save - BudgetTransaction saved with ID: 94
[2025-08-09 16:16:13] DEBUG [budgets.models:671] save - Starting save for BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:16:13] ERROR [budgets.models:709] save - Error saving BudgetTransaction: 'NoneType' object has no attribute 'pk'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 684, in save
    self.clean()
    ~~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 659, in clean
    f"Cleaning BudgetTransaction: amount={self.amount}, type={self.transaction_type}, allocation ID={self.allocation.pk}")
                                                                                                     ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'pk'
[2025-08-09 16:17:18] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_23_no_filters', 'free_budget_85'}
[2025-08-09 16:17:18] DEBUG [budgets.models:670] save - Starting save for BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:17:18] INFO [budgets.models:665] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:17:18] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-cc47c208b4ae created. Invalidating cache for allocation 85
[2025-08-09 16:17:18] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'project_remaining_budget_8', 'returned_budgets_23_all_no_filters', 'budget_transfers_23_no_filters', 'free_budget_85'}
[2025-08-09 16:17:18] INFO [budgets.models:685] save - BudgetTransaction saved with ID: 95
[2025-08-09 16:17:18] DEBUG [budgets.models:670] save - Starting save for BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:17:18] ERROR [budgets.models:708] save - Error saving BudgetTransaction: 'NoneType' object has no attribute 'pk'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 683, in save
    self.clean()
    ~~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 665, in clean
    logger.info(f"BudgetTransaction validated successfully for allocation ID: {self.allocation.pk}")
                                                                               ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'pk'
[2025-08-09 16:19:05] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'tankhah_report_23_no_filters', 'free_budget_85'}
[2025-08-09 16:19:05] DEBUG [budgets.models:670] save - Starting save for BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:19:05] INFO [budgets.models:665] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:19:05] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-72417f240661 created. Invalidating cache for allocation 85
[2025-08-09 16:19:05] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'budget_transfers_23_no_filters', 'free_budget_85', 'returned_budgets_23_all_no_filters', 'project_remaining_budget_8'}
[2025-08-09 16:19:05] INFO [budgets.models:682] save - BudgetTransaction saved with ID: 96
[2025-08-09 16:19:05] DEBUG [budgets.models:670] save - Starting save for BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:19:05] ERROR [budgets.models:705] save - Error saving BudgetTransaction: 'NoneType' object has no attribute 'pk'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 680, in save
    self.clean()
    ~~~~~~~~~~^^
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\models.py", line 665, in clean
    logger.info(f"BudgetTransaction validated successfully for allocation ID: {self.allocation.pk}")
                                                                               ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'pk'
[2025-08-09 16:20:51] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_85', 'tankhah_report_23_no_filters'}
[2025-08-09 16:20:51] DEBUG [budgets.models:684] save - Starting save for BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:20:51] DEBUG [budgets.models:663] clean - Cleaning BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:20:51] INFO [budgets.models:679] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:20:51] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-3764600fc192 created. Invalidating cache for allocation 85
[2025-08-09 16:20:51] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_85', 'project_remaining_budget_8', 'budget_transfers_23_no_filters', 'returned_budgets_23_all_no_filters'}
[2025-08-09 16:20:51] INFO [budgets.models:696] save - BudgetTransaction saved with ID: 97
[2025-08-09 16:20:51] DEBUG [budgets.models:684] save - Starting save for BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:20:51] DEBUG [budgets.models:663] clean - Cleaning BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:20:51] INFO [budgets.models:679] clean - BudgetTransaction validated successfully for allocation ID: N/A
[2025-08-09 16:20:51] ERROR [budgets.signals:39] update_remaining_amount - Error updating caches for BudgetTransaction 98: 'NoneType' object has no attribute 'id'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\signals.py", line 31, in update_remaining_amount
    logger.debug(f"BudgetTransaction {instance.transaction_id} created. Invalidating cache for allocation {allocation.id}")
                                                                                                           ^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'id'
[2025-08-09 16:20:51] ERROR [budgets.signals:57] invalidate_transaction_cache - Error invalidating cache for BudgetTransaction 98: 'NoneType' object has no attribute 'pk'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\signals.py", line 46, in invalidate_transaction_cache
    cache_keys.add(f"free_budget_{allocation.pk}")
                                  ^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'pk'
[2025-08-09 16:20:51] INFO [budgets.models:696] save - BudgetTransaction saved with ID: 98
[2025-08-09 16:22:10] DEBUG [budgets.signals:85] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_85', 'tankhah_report_23_no_filters'}
[2025-08-09 16:22:10] DEBUG [budgets.models:684] save - Starting save for BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:22:10] DEBUG [budgets.models:663] clean - Cleaning BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:22:10] INFO [budgets.models:679] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:22:10] DEBUG [budgets.signals:31] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-4ff5d082b897 created. Invalidating cache for allocation 85
[2025-08-09 16:22:10] DEBUG [budgets.signals:55] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_85', 'budget_transfers_23_no_filters', 'project_remaining_budget_8', 'returned_budgets_23_all_no_filters'}
[2025-08-09 16:22:10] INFO [budgets.models:696] save - BudgetTransaction saved with ID: 99
[2025-08-09 16:22:10] DEBUG [budgets.models:684] save - Starting save for BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:22:10] DEBUG [budgets.models:663] clean - Cleaning BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:22:10] INFO [budgets.models:679] clean - BudgetTransaction validated successfully for allocation ID: N/A
[2025-08-09 16:22:10] ERROR [budgets.signals:39] update_remaining_amount - Error updating caches for BudgetTransaction 100: 'NoneType' object has no attribute 'pk'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\signals.py", line 31, in update_remaining_amount
    logger.debug(f"BudgetTransaction {instance.transaction_id} created. Invalidating cache for allocation {allocation.pk}")
                                                                                                           ^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'pk'
[2025-08-09 16:22:10] ERROR [budgets.signals:57] invalidate_transaction_cache - Error invalidating cache for BudgetTransaction 100: 'NoneType' object has no attribute 'pk'
Traceback (most recent call last):
  File "D:\Design & Source Code\Source Coding\Tanbakhsystem\budgets\signals.py", line 46, in invalidate_transaction_cache
    cache_keys.add(f"free_budget_{allocation.pk}")
                                  ^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'pk'
[2025-08-09 16:22:10] INFO [budgets.models:696] save - BudgetTransaction saved with ID: 100
[2025-08-09 16:26:35] DEBUG [budgets.signals:102] invalidate_tankhah_cache - Invalidated cache keys after Tankhah change: {'free_budget_85', 'tankhah_report_23_no_filters'}
[2025-08-09 16:26:35] DEBUG [budgets.models:684] save - Starting save for BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:26:35] DEBUG [budgets.models:663] clean - Cleaning BudgetTransaction: amount=785000, type=CONSUMPTION, allocation ID=85
[2025-08-09 16:26:35] INFO [budgets.models:679] clean - BudgetTransaction validated successfully for allocation ID: 85
[2025-08-09 16:26:35] DEBUG [budgets.signals:34] update_remaining_amount - BudgetTransaction TX-CONSUMPTION-85-4dd46b5518cf created. Invalidating cache for allocation 85
[2025-08-09 16:26:35] DEBUG [budgets.signals:72] invalidate_transaction_cache - Invalidated cache keys after BudgetTransaction change: {'free_budget_85', 'returned_budgets_23_all_no_filters', 'budget_transfers_23_no_filters', 'project_remaining_budget_8'}
[2025-08-09 16:26:35] INFO [budgets.models:696] save - BudgetTransaction saved with ID: 101
[2025-08-09 16:26:35] DEBUG [budgets.models:684] save - Starting save for BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:26:35] DEBUG [budgets.models:663] clean - Cleaning BudgetTransaction: amount=785000, type=ALLOCATION, allocation ID=N/A
[2025-08-09 16:26:35] INFO [budgets.models:679] clean - BudgetTransaction validated successfully for allocation ID: N/A
[2025-08-09 16:26:35] INFO [budgets.models:696] save - BudgetTransaction saved with ID: 102

# مستندات منسوخ شدن سیستم گردش کار قدیمی

این سند برای ثبت یک تغییر مهم در معماری سیستم گردش کار (Workflow) پروژه ایجاد شده است.

## منسوخ شدن مدل‌های `WorkflowStage` و `AccessRule`

در نسخه‌های اولیه پروژه، منطق گردش کار و مدیریت مراحل تأیید از طریق دو مدل زیر انجام می‌شد:

- `core.WorkflowStage`: برای تعریف مراحل ثابت (مانند تأیید مدیر واحد، تأیید مدیر مالی).
- `core.AccessRule`: برای تعریف قوانین دسترسی و اینکه چه پستی در چه مرحله‌ای چه اقدامی می‌تواند انجام دهد.

**این دو مدل به طور کامل منسوخ شده و دیگر در منطق اصلی سیستم استفاده نمی‌شوند.** اگرچه ممکن است هنوز در کدبیس وجود داشته باشند، اما نباید برای توسعه جدید یا تغییرات از آن‌ها استفاده کرد.

## معرفی سیستم گردش کار جدید مبتنی بر گذار (Transition-Based)

سیستم جدید، یک موتور گردش کار بسیار انعطاف‌پذیر و داینامیک است که بر اساس چهار مدل اصلی در اپلیکیشن `core` کار می‌کند:

1.  **`EntityType`**: تعریف نوع موجودیت‌هایی که دارای گردش کار هستند (مانند فاکتور، تنخواه).
2.  **`Status`**: تعریف وضعیت‌های ممکن برای یک موجودیت (مانند پیش‌نویس، تأیید نهایی، رد شده).
3.  **`Action`**: تعریف اقدامات یا "فعل"هایی که کاربر می‌تواند انجام دهد (مانند ارسال، تأیید، رد کردن).
4.  **`Transition`**: قلب تپنده سیستم جدید. این مدل این چهار بخش را به هم متصل می‌کند و یک قانون را تعریف می‌کند. برای مثال:

> یک **`Transition`** تعریف می‌کند که موجودیت از نوع **`FACTOR`** (`EntityType`) که در وضعیت **`DRAFT`** (`from_status`) قرار دارد، می‌تواند با اقدام **`SUBMIT`** (`action`) توسط پستی که در **`allowed_posts`** مشخص شده، به وضعیت **`PENDING_APPROVAL`** (`to_status`) منتقل شود.

### مزایای سیستم جدید

-   **انعطاف‌پذیری کامل**: تمام فرآیندهای تأیید را می‌توان از طریق پنل ادمین و بدون هیچ تغییری در کد، تعریف، ویرایش یا حذف کرد.
-   **شفافیت**: مسیر حرکت یک سند در فرآیند تأیید کاملاً شفاف و قابل تعریف است.
-   **قابلیت توسعه بالا**: اضافه کردن گردش کار برای موجودیت‌های جدید در آینده بسیار ساده است.

**توصیه مهم:** برای هرگونه توسعه یا تغییری که به فرآیندهای تأیید و گردش کار مربوط می‌شود، **باید** از مدل‌های جدید (`EntityType`, `Status`, `Action`, `Transition`) استفاده شود.

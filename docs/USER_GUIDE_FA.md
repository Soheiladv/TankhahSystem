## راهنمای کاربری سیستم بودجه و تنخواه (BudgetsSystem)

این سند راهنمایی عملی برای کار با سیستم است و مهم‌ترین قابلیت‌ها، نقش‌ها، گردش‌کار، گزارش‌ها و نکات کاربردی را پوشش می‌دهد.

### مخاطبان
- کاربر درخواست‌کننده تنخواه/ثبت هزینه
- مدیر/تاییدکننده فرآیندها
- حسابدار و مدیر مالی
- راهبر سیستم (ادمین)

---

### ورود و دسترسی
- آدرس ورود: `/accounts/login/`
- دسترسی‌ها مبتنی بر نقش (RBAC) است. نقش‌ها و گروه‌ها در `پنل مدیریت > کاربران و نقش‌ها` تعریف و تخصیص می‌شوند.
- وضعیت قفل نرم‌افزار و تعداد کاربران فعال از مسیر `/lock-status/` قابل مشاهده و از `/set-lock/` قابل تنظیم (با سطح دسترسی ادمین) است.

---

### داشبوردها و گزارش‌ها
- داشبورد اصلی بودجه و عملکرد: `/reports/dashboard/`
- داشبورد تحلیلی (Analytics): `/reports/dashboard/analytics/`
- داشبورد خروجی و صادرات: `/reports/dashboard/export/`
- گزارش جامع بودجه و تخصیص/مصرف: `/reports/comprehensive-budget/`
- پیش‌نمایش و خروجی داده‌ها در فرمت‌های JSON/CSV/Excel از مسیرهای بخش Export در داشبورد گزارش‌ها.

---

### ماژول‌ها و مسیرهای کلیدی
- کاربران و نقش‌ها: `/accounts/` (لیست کاربران، نقش‌ها، گروه‌ها، تغییر کلمه عبور)
- بودجه‌ها: `/budgets/` (دوره بودجه، تخصیص، تراکنش‌ها، برگشت بودجه)
- تنخواه و فاکتورها: `/tankhah/` (درخواست/ایجاد تنخواه، ثبت فاکتور هزینه، مسیرهای تایید)
- مدیریت گردش‌کار و تنظیمات سیستمی: `/workflow/` و بخش‌های مرتبط در `core`
- نسخه‌ها و پشتیبان: `/version_tracker/` و `backup-admin/`

---

### فرآیند نمونه: ثبت هزینه از طریق تنخواه
1) ایجاد یا انتخاب تنخواه فعال
2) ثبت فاکتور و اقلام هزینه
3) ارسال برای تایید طبق گردش‌کار تعریف‌شده
4) کنترل سقف و مانده بودجه به‌صورت خودکار
5) صدور حواله/حکم پرداخت (در صورت تایید نهایی)
6) ثبت در گزارش‌ها و داشبوردها؛ امکان خروجی‌گیری

نکته: مسیر تاییدها داینامیک است و توسط موتور گردش‌کار قابل تنظیم است.

---

### امکانات کلیدی سیستم
- موتور گردش‌کار داینامیک و قابل پیکربندی برای تایید/رد اسناد
- کنترل دسترسی مبتنی بر نقش (RBAC) با نقش‌ها و گروه‌های قابل مدیریت
- لاگ ممیزی کامل فعالیت‌ها برای حسابرسی (Audit Trail)
- مدیریت دوره‌های بودجه، تخصیص بودجه و تراکنش‌های مصرف/افزایش/کاهش/برگشت
- مدیریت تنخواه و فاکتور با مسیرهای تایید شفاف و قابل رهگیری
- داشبوردهای تحلیلی با فیلترهای پیشرفته و نمودارهای تعاملی
- APIهای گزارش‌گیری و سرویس‌های AJAX برای بارگذاری پویا
- خروجی‌گیری متنوع: JSON، CSV و Excel
- نسخه‌سازی و پشتیبان‌گیری یکپارچه (Version Tracker و Backup)
- قفل نرم‌افزاری برای مدیریت لایسنس و کاربران فعال
- اعلان‌ها و نوتیفیکیشن‌ها (Inbox/Notifications)
- بومی‌سازی فارسی و تاریخ جلالی در نماها و گزارش‌ها

---

### نقاط قوت و مزایا
- انعطاف‌پذیری بالا در تعریف فرآیندهای سازمانی به‌واسطه موتور گردش‌کار
- شفافیت و پاسخگویی با ثبت ریزفعالیت‌ها و تاریخچه تغییرات
- یکپارچگی بودجه و تنخواه: از برنامه‌ریزی تا مصرف و گزارش نهایی
- کنترل دقیق سقف‌ها و مانده بودجه به‌صورت خودکار در لحظه ثبت/تایید
- گزارش‌ها و داشبوردهای مدیریتی با قابلیت مقایسه دوره‌ای و پروژه‌ای
- کاهش خطای انسانی با فرم‌های هدایت‌شده و اعتبارسنجی سمت سرور/کلاینت
- امکان توسعه و سفارشی‌سازی سریع به‌دلیل معماری ماژولار مبتنی بر Django
- قابلیت صادرات داده برای تحلیل‌های بیرونی (Excel/BI)

---

### نقش‌ها و دسترسی‌ها (نمونه)
- درخواست‌کننده: ایجاد تنخواه/ثبت فاکتور، مشاهده وضعیت تایید
- تاییدکننده: بررسی و تایید/رد بر اساس نقش سازمانی و قواعد گردش‌کار
- حسابدار: ثبت حواله پرداخت، تطبیق‌ها، کنترل‌های بودجه
- مدیر سیستم: مدیریت کاربران/نقش‌ها/گروه‌ها، تنظیمات قفل و نسخه‌ها

---

### نکات عملیاتی
- قبل از شروع سال مالی جدید، دوره بودجه را ایجاد و تخصیص‌ها را تعریف کنید.
- برای هر پروژه/سازمان تا حد امکان ردیف‌های بودجه‌ای را ساختارمند تعریف کنید تا گزارش‌ها تفکیک‌پذیر باشند.
- از قابلیت Export برای صحت‌سنجی دوره‌ای اطلاعات و تهیه گزارش‌های مدیریتی استفاده کنید.
- در صورت تغییر ساختار سازمانی، نقش‌ها و گروه‌ها را به‌روزرسانی کنید تا دسترسی‌ها صحیح بمانند.

---

### عیب‌یابی سریع
- عدم دسترسی به یک صفحه: نقش/گروه کاربر را بررسی کنید.
- عدم امکان تایید: وضعیت گردش‌کار و شروط مجوزها را بررسی کنید.
- مغایرت مانده بودجه: گزارش تراکنش‌های بودجه و برگشت‌ها را مرور کنید.
- خطا در خروجی Excel/CSV: فیلترها و محدوده تاریخ را بازبینی و مجدداً خروجی‌گیری کنید.

---

### منابع تکمیلی
- مستندات فنی: `docs/PROJECT_DOCUMENTATION.md`
- خلاصه پیاده‌سازی داشبورد: `docs/DASHBOARD_IMPLEMENTATION_SUMMARY.md`
- مستندات API گزارش‌ها: `docs/API_DOCUMENTATION.md`


